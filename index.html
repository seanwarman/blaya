<html>
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	<head>
		<link rel="stylesheet" href="index.css">
	</head>
	<body>
    <header>
      <div class="search-container">
        <label hidden for="search-input">Search</label>
        <input id="search-input" type="input" placeholder="âŒ˜ K" />
        <button tabindex="0" id="clear-search-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#e2e2e2" d="M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/></svg>
        </button>
      </div>
      <button id="target-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 0c17.7 0 32 14.3 32 32V66.7C368.4 80.1 431.9 143.6 445.3 224H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H445.3C431.9 368.4 368.4 431.9 288 445.3V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V445.3C143.6 431.9 80.1 368.4 66.7 288H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H66.7C80.1 143.6 143.6 80.1 224 66.7V32c0-17.7 14.3-32 32-32zM128 256a128 128 0 1 0 256 0 128 128 0 1 0 -256 0zm128-80a80 80 0 1 1 0 160 80 80 0 1 1 0-160z"/></svg>
      </button>
    </header>
    <div id="track-list-container"></div>
		<footer>
			<div tabindex="0" id="current-playing-text" role="button"></div>
			<audio tabindex="-1" id="player" controls>
				<source id="current-track" type="audio/mpeg"></source>
			</audio>
			<button id="prev-button" role="link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M267.5 440.6c9.5 7.9 22.8 9.7 34.1 4.4s18.4-16.6 18.4-29V96c0-12.4-7.2-23.7-18.4-29s-24.5-3.6-34.1 4.4l-192 160L64 241V96c0-17.7-14.3-32-32-32S0 78.3 0 96V416c0 17.7 14.3 32 32 32s32-14.3 32-32V271l11.5 9.6 192 160z"/></svg>
      </button>
			<button id="next-button" role="link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z"/></svg>
      </button>
		</footer>
	</body>
	<script type="module">
    import { trackList as rawTrackList } from './track-list.js'
    import { simpleHash, setDebounce } from './helpers/utils.js'
    import {
      appendTracksByPage,
      parseTrackList,
    } from './helpers/index.js'
    import {
      onClearSearch,
      onSearch,
      onNext,
      onPrev,
      onScrollThisTrack,
      onClickOrEnter,
      onScroll,
    } from './helpers/events.js'

		window.state = {
      trackList: parseTrackList(rawTrackList),
      currentTrackId: null,
      texts: [],
      throttleId: null,
      throttleGap: 500,
      page: 1,
      numberOfPages: 3,
      lazyLoadDebounce: false,
      searching: false,
      searchingPage: 1,
      previousScrollPositionY: 0,
      pageSize: 300,
      previousTrackListContainer: null,
		}

    // BEGIN
    window.state.page = appendTracksByPage(window.state.trackList)(1)

    window.onscroll = onScroll(window.state.trackList)
    document.getElementById('player').onended = onNext(window.state.trackList)
		document.getElementById('next-button').onclick = onClickOrEnter(onNext(window.state.trackList))
		document.getElementById('next-button').onkeydown = onClickOrEnter(onNext(window.state.trackList))
		document.getElementById('prev-button').onclick = onClickOrEnter(onPrev(window.state.trackList))
		document.getElementById('prev-button').onkeydown = onClickOrEnter(onPrev(window.state.trackList))
    document.getElementById('target-button').onclick = onClickOrEnter(onScrollThisTrack(window.state.trackList))
    document.getElementById('target-button').onkeydown = onClickOrEnter(onScrollThisTrack(window.state.trackList))
    document.getElementById('current-playing-text').onclick = onClickOrEnter(onScrollThisTrack(window.state.trackList))
    document.getElementById('current-playing-text').onkeydown = onClickOrEnter(onScrollThisTrack(window.state.trackList))
    document.getElementById('search-input').oninput = onSearch(window.state.trackList)
    document.getElementById('search-input').onkeydown = e => e.stopPropagation()
    document.getElementById('clear-search-button').onclick = onClickOrEnter(onClearSearch)
    document.getElementById('clear-search-button').onkeydown = onClickOrEnter(onClearSearch)

		// Key commands...
		const onKey = (...maps) => e => {
			maps.forEach(([key, cb]) => {
      if(
        (typeof key === 'string' && e.key === key)
        || (key.key === e.key && key.ctrlKey === e.ctrlKey)
        || (key.key === e.key && key.metaKey === e.metaKey)
      ) {
					e.preventDefault()
					cb(e)
				}
			})
		}

		document.onkeydown = onKey(
			[' ', e => {
				const player = document.getElementById('player')
				if (player.paused) {
					player.play()
				} else {
					player.pause()
				}
			}],
			['ArrowRight', onNext],
			['ArrowLeft', onPrev],
      [{ key: 'k', ctrlKey: true }, () => document.getElementById('search-input').focus()],
      [{ key: 'k', metaKey: true }, () => document.getElementById('search-input').focus()],
      ['Escape', () => document.getElementById('search-input').blur()],
		)

	</script>
<html>
